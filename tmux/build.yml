---
- hosts: 127.0.0.1
  connection: local
  sudo: yes
  vars:
    libevent_url: "https://sourceforge.net/projects/levent/files/libevent/libevent-2.0/libevent-2.0.22-stable.tar.gz"
    libevent_file: "libevent-2.0.22-stable.tar.gz"
    libevent_conf: "/etc/ld.so.conf.d/libevent.conf"
    tmux_url: "http://downloads.sourceforge.net/project/tmux/tmux/tmux-1.9/tmux-1.9a.tar.gz"
    tmux_file: "tmux-1.9a.tar.gz"
    src_dir: "/usr/local/src"
    lib_dir: "/usr/local/lib"
  tasks:
    # install libevent
    - get_url: url={{libevent_url}} dest={{src_dir}}/{{libevent_file}}
    - shell: tar xvf {{libevent_file}}
      args:
        chdir: "{{src_dir}}"
        creates: "{{src_dir}}/libevent-2.0.22-stable"
    - shell: ./configure && make && make install
      args:
        chdir: "{{src_dir}}/libevent-2.0.22-stable"
        creates: "{{lib_dir}}/libevent.a"
    # ldconfig
    - shell: echo "{{lib_dir}}" > {{libevent_conf}} && ldconfig

    # install tmux
    - get_url: url={{tmux_url}} dest={{src_dir}}/{{tmux_file}}
    - shell: tar xvf {{tmux_file}}
      args:
        chdir: "{{src_dir}}"
        creates: "{{src_dir}}/tmux-1.9a"
    - shell: ./configure && make && make install
      args:
        chdir: "{{src_dir}}/tmux-1.9a"
        creates: "/usr/local/bin/tmux"
